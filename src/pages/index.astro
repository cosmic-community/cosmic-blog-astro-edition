---
// src/pages/index.astro
import Layout from '@/layouts/Layout.astro'
import Header from '@/components/Header.astro'
import Footer from '@/components/Footer.astro'
import PostCard from '@/components/PostCard.astro'
import { getAllPosts, getAllCategories } from '@/lib/cosmic'

const posts = await getAllPosts()
const categories = await getAllCategories()

// Sort posts by created_at descending
const sortedPosts = posts.sort((a, b) => {
  const dateA = new Date(a.created_at || '').getTime()
  const dateB = new Date(b.created_at || '').getTime()
  return dateB - dateA
})

const featuredPost = sortedPosts[0]
const remainingPosts = sortedPosts.slice(1)
---

<Layout title="Cosmic Blog ‚Äî A Modern Blog Powered by Cosmic & Astro">
  <Header />

  <main class="flex-1">
    {/* Hero Section */}
    <section class="bg-gradient-to-b from-primary-50/60 to-white py-16 md:py-24">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h1 class="text-4xl md:text-6xl font-extrabold text-gray-900 leading-tight mb-4">
          Welcome to <span class="text-primary-600">Cosmic Blog</span>
        </h1>
        <p class="text-lg md:text-xl text-gray-500 max-w-2xl mx-auto">
          Exploring ideas across technology, travel, and more ‚Äî powered by Cosmic headless CMS and built with Astro.
        </p>
      </div>
    </section>

    {/* Categories */}
    {categories.length > 0 && (
      <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 -mt-6 mb-12">
        <div class="flex flex-wrap justify-center gap-3">
          {/* Changed: Improved category tag buttons with shadow, better colors, and hover transform */}
          {categories.map((cat) => (
            <a
              href={`/categories/${cat.slug}`}
              class="category-badge bg-white text-gray-600 border border-gray-200 shadow-sm hover:bg-primary-50 hover:text-primary-700 hover:border-primary-300 hover:shadow-md hover:-translate-y-0.5"
            >
              üè∑Ô∏è {cat.metadata.name}
            </a>
          ))}
        </div>
      </section>
    )}

    {/* Featured Post */}
    {featuredPost && (
      <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 mb-12">
        <h2 class="text-sm font-semibold text-primary-600 uppercase tracking-wider mb-4">Featured</h2>
        <PostCard post={featuredPost} featured={true} />
      </section>
    )}

    {/* All Posts */}
    {remainingPosts.length > 0 && (
      <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pb-20">
        <h2 class="text-sm font-semibold text-primary-600 uppercase tracking-wider mb-6">Latest Posts</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          {remainingPosts.map((post) => (
            <PostCard post={post} />
          ))}
        </div>
      </section>
    )}

    {/* Empty State */}
    {posts.length === 0 && (
      <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-20 text-center">
        <p class="text-xl text-gray-400">No posts found. Add content in your Cosmic dashboard.</p>
      </section>
    )}
  </main>

  <Footer />
</Layout>